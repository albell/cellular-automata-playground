(function(w,doc,$){"use strict";const $window=$(w);const $html=$("html");const $header=$("header");const ruleCheckboxes=doc.getElementsByClassName("rule__checkbox");const $ruleNumberNumeric=$("#rule-number-numeric");const $ruleNumberSpan=$(".rule-name-number");const $mirrorNumberSpan=$(".mirror-rule-name-number");const $ringLength=$("#length");const $iteration=$("#iteration");const $gridGroup=$("#grid-group");const $initialState=$("#initial-state");const initialStateEl=$initialState[0];const initCheckboxes=doc.getElementsByClassName("init__checkbox");const urlHashCheckbox=$("#url-hash");const screenDpr=w.devicePixelRatio||1;var canvas=doc.getElementById("c");var canvasMainCtx=canvas.getContext("2d");var canvasBorders=doc.getElementById("c-inner-borders");var canvasBordersCtx=canvasBorders.getContext("2d");var canvasBoxDevicePixels;var canvasWidthDevicePixels;var canvasHeightDevicePixels;var ruleArray;var initArray;var lengthCount;var iterationCount;var ruleAsBase2Str;var mirrorRuleAsBase2Str;var ruleNumber;var mirrorRuleNumber;var generatedArray;var simpleMap=Object.create(null);Object.defineProperties(simpleMap,{111:{value:0},110:{value:1},101:{value:2},100:{value:3},"011":{value:4},"010":{value:5},"001":{value:6},"000":{value:7}});var opts=Object.create(null);Object.defineProperties(opts,{setUrlHash:{value:false,writable:true},useAnimation:{value:true,writable:true}});var ignoreHashChange=false;var initCell=doc.createElement("div");initCell.className="c";function debounce(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}function toggleBinaryStr(b){if(b==="0"){return"1"}else if(b==="1"){return"0"}}function booleanToBinary(bool){return bool?1:0}function binArrayToBinStr(binArr){var binStr="";for(var i=0,len=binArr.length;i<len;i++){binStr+=binArr[i]}return binStr}function invertBinaryStr(base2Str){var i;var invertedStr="";for(i=0;i<8;i+=1){invertedStr+=toggleBinaryStr(base2Str.charAt(i))}return invertedStr}function base2StrToRuleNumber(base2Str){return parseInt(base2Str,2)}function ruleNumberToBase2Str(ruleNumber){var str=ruleNumber.toString(2);while(str.length<8){str="0"+str}return str}function updateRuleArray(base2Str){ruleArray=new Int8Array(8);for(var i=0;i<8;i+=1){ruleArray[i]=parseInt(base2Str[i],10)}}function getBase2StrFromRuleCheckboxes(){var newBase2Str="";var i;for(i=0;i<8;i+=1){newBase2Str+=booleanToBinary(ruleCheckboxes[i].checked).toString()}return newBase2Str}function getInitArrayFromCheckboxes(){var len=initCheckboxes.length;initArray=new Int8Array(len);for(var i=0;i<len;i++){if(initCheckboxes[i].checked){initArray[i]=1}}}function setInitStateCheckboxesFromInitArray(){var len=initCheckboxes.length;for(var i=0;i<len;i+=1){initCheckboxes[i].checked=!!initArray[i]}}function updateLength(){lengthCount=parseInt($ringLength.val(),10)}function updateIterationCount(){iterationCount=parseInt($iteration.val(),10)}function resolveInitCellCount(diff){var addedCellsFrag;var newCell;var labelVal;var i;var last;if(diff===0){return false}else if(diff>0){addedCellsFrag=doc.createDocumentFragment();for(i=0;i<diff;i+=1){labelVal="init"+(lengthCount+i);newCell=initCell.cloneNode(true);newCell.innerHTML="<input id='"+labelVal+"' class=init__checkbox "+"type=checkbox>"+"<label for='"+labelVal+"' class='init__label square'></label>";addedCellsFrag.appendChild(newCell)}initialStateEl.appendChild(addedCellsFrag)}else if(diff<0){for(i=0;i>diff;i-=1){last=initialStateEl.lastChild;initialStateEl.removeChild(last)}}lengthCount=lengthCount+diff}function genCell(prevLeft,prev,prevRight){var concat=prevLeft.toString()+prev.toString()+prevRight.toString();var theCase=simpleMap[concat];return ruleArray[theCase]}function generateFullArray(){var i,j,prevLNebr,prevSelf,prevRNebr;generatedArray=new Int8Array(iterationCount*lengthCount);for(j=0;j<lengthCount;j+=1){prevLNebr=initArray[j-1];prevSelf=initArray[j];prevRNebr=initArray[j+1];if(j===0){prevLNebr=initArray[lengthCount-1]}if(j===lengthCount-1){prevRNebr=initArray[0]}generatedArray[j]=genCell(prevLNebr,prevSelf,prevRNebr)}for(i=1;i<iterationCount;i+=1){for(j=0;j<lengthCount;j+=1){prevLNebr=generatedArray[(i-1)*lengthCount+j-1];prevSelf=generatedArray[(i-1)*lengthCount+j];prevRNebr=generatedArray[(i-1)*lengthCount+j+1];if(j===0){prevLNebr=generatedArray[i*lengthCount-1]}if(j===lengthCount-1){prevRNebr=generatedArray[(i-1)*lengthCount]}generatedArray[i*lengthCount+j]=genCell(prevLNebr,prevSelf,prevRNebr)}}}function clearMainCanvas(){canvasMainCtx.clearRect(0,0,canvasWidthDevicePixels,canvasHeightDevicePixels)}function drawAllRects(){var cbdp=canvasBoxDevicePixels;for(var i=0;i<iterationCount;i+=1){for(var j=0;j<lengthCount;j+=1){if(generatedArray[i*lengthCount+j]){canvasMainCtx.fillRect(j*cbdp,i*cbdp,cbdp,cbdp)}}}}function resetWindowAndCanvasDims(){var canvasWidthMeasuredPixels=canvas.offsetWidth*screenDpr;canvasBoxDevicePixels=Math.ceil(canvasWidthMeasuredPixels/lengthCount);canvasWidthDevicePixels=canvasBoxDevicePixels*lengthCount;canvasHeightDevicePixels=canvasBoxDevicePixels*iterationCount;canvas.width=canvasBorders.width=canvasWidthDevicePixels;canvas.height=canvasBorders.height=canvasHeightDevicePixels}function drawCanvasBorders(){canvasBordersCtx.beginPath();canvasBordersCtx.strokeStyle="#777777";for(var i=1;i<lengthCount;i+=1){canvasBordersCtx.moveTo(canvasBoxDevicePixels*i-.5,0);canvasBordersCtx.lineTo(canvasBoxDevicePixels*i-.5,canvasHeightDevicePixels)}for(var j=1;j<iterationCount;j+=1){canvasBordersCtx.moveTo(0,canvasBoxDevicePixels*j-.5);canvasBordersCtx.lineTo(canvasWidthDevicePixels,canvasBoxDevicePixels*j-.5)}canvasBordersCtx.stroke()}function onResize(){resetWindowAndCanvasDims();drawCanvasBorders();drawAllRects()}function updateRules(newRuleNumber){ruleNumber=newRuleNumber;ruleAsBase2Str=ruleNumberToBase2Str(newRuleNumber);mirrorRuleAsBase2Str=invertBinaryStr(ruleAsBase2Str);mirrorRuleNumber=base2StrToRuleNumber(mirrorRuleAsBase2Str);$ruleNumberSpan.html(ruleNumber);$mirrorNumberSpan.html(mirrorRuleNumber)}function setNewRuleOnCheckboxesSilently(newRuleNumber,oldRuleNumber){var newRuleAsBase2Str=ruleNumberToBase2Str(newRuleNumber);var oldRuleAsBase2Str=ruleNumberToBase2Str(oldRuleNumber);var checkboxCheckedOld,checkboxCheckedNew;for(var i=0;i<8;i+=1){checkboxCheckedOld=ruleCheckboxes[i].checked;checkboxCheckedNew=!!parseInt(oldRuleAsBase2Str.charAt(i),10);if(newRuleAsBase2Str[i]!==oldRuleAsBase2Str[i]){ruleCheckboxes[i].checked=!!parseInt(newRuleAsBase2Str.charAt(i),10)}}}function setWindowHashSilently(){if(opts.setUrlHash){ignoreHashChange=true;w.location.hash="#rule="+ruleAsBase2Str+"&init="+binArrayToBinStr(initArray)+"&iter="+iterationCount}}function deserializeHash(hash){var hashObj=Object.create(null);var hashArray=hash.split("&");var i;var len=hashArray.length;var s;for(i=0;i<len;i+=1){if(!hashArray[i]){continue}s=hashArray[i].split("=");Object.defineProperty(hashObj,s[0],{value:s[1]})}return hashObj}function updateValsFromHash(){var hash,hashObj,initArrayFromHash,numericHashIter,oldRuleNumber;if(w.location.hash){hash=w.location.hash.substring(1)}if(!hash){return false}hashObj=deserializeHash(hash);if(hashObj){opts.setUrlHash=true;urlHashCheckbox.prop("checked",true)}if(hashObj.rule&&hashObj.rule.length===8&&hashObj.rule!==ruleAsBase2Str){ruleAsBase2Str=hashObj.rule;oldRuleNumber=ruleNumber;ruleNumber=base2StrToRuleNumber(ruleAsBase2Str);$ruleNumberNumeric.val(ruleNumber);setNewRuleOnCheckboxesSilently(ruleNumber,oldRuleNumber);updateRules(ruleNumber);updateRuleArray(ruleNumberToBase2Str(ruleNumber))}if(hashObj.init){initArrayFromHash=hashObj.init.split("").map(function(str){return parseInt(str,10)});if(initArray!==initArrayFromHash){initArray=initArrayFromHash;$ringLength.val(hashObj.init.length);resolveInitCellCount(hashObj.init.length-lengthCount);setInitStateCheckboxesFromInitArray()}}if(hashObj.iter){numericHashIter=parseInt(hashObj.iter,10);if(numericHashIter!==iterationCount){iterationCount=numericHashIter;$iteration.val(hashObj.iter)}}}ruleAsBase2Str=getBase2StrFromRuleCheckboxes();updateRuleArray(ruleAsBase2Str);updateRules(base2StrToRuleNumber(ruleAsBase2Str));getInitArrayFromCheckboxes();updateLength();updateIterationCount();updateValsFromHash();resetWindowAndCanvasDims();drawCanvasBorders();generateFullArray();drawAllRects();$window.on("hashchange",function handleHashChange(){if(ignoreHashChange===false){updateValsFromHash();drawCanvasBorders();generateFullArray();drawAllRects()}ignoreHashChange=false});$(ruleCheckboxes).on("change",function handleRuleCheckboxChange(){ruleNumber=base2StrToRuleNumber(getBase2StrFromRuleCheckboxes());$ruleNumberNumeric.val(ruleNumber).triggerHandler("change")});$ruleNumberNumeric.on("change",function(event,previousRulePassed){var oldRuleNumber;if(previousRulePassed!==undefined){oldRuleNumber=previousRulePassed}else{oldRuleNumber=ruleNumber}ruleNumber=parseInt($(this).val(),10);setNewRuleOnCheckboxesSilently(ruleNumber,oldRuleNumber);updateRules(ruleNumber);updateRuleArray(ruleNumberToBase2Str(ruleNumber));setWindowHashSilently();generateFullArray();clearMainCanvas();drawAllRects()});$(".mirror-rule-button").on("click",function setMirrorRule(){var oldRuleNumber=ruleNumber;ruleNumber=mirrorRuleNumber;$ruleNumberNumeric.val(mirrorRuleNumber).triggerHandler("change",oldRuleNumber)});$("[data-go-to-rule]").on("click",function goToRule(){var oldRuleNumber=ruleNumber;ruleNumber=parseInt($(this).attr("data-go-to-rule"),10);$ruleNumberNumeric.val(ruleNumber).triggerHandler("change",oldRuleNumber)});$(".plus-button, .minus-button").on("mousedown keypress",function(){var $input=$(this).siblings("input");var currentVal=parseInt($input.val(),10);var newVal;var min=parseInt($input.attr("min"));var max=parseInt($input.attr("max"));var direction=$(this).attr("data-direction");if(direction==="increment"){if(currentVal===max){return false}newVal=currentVal+1}else if(direction==="decrement"){if(currentVal===min){return false}newVal=currentVal-1}$input.val(newVal).triggerHandler("change")});$ringLength.on("change",function(){var diff=$(this).val()-lengthCount;resolveInitCellCount(diff);getInitArrayFromCheckboxes();setWindowHashSilently();resetWindowAndCanvasDims();drawCanvasBorders();generateFullArray();clearMainCanvas();drawAllRects()});$iteration.on("change",function(){updateIterationCount();setWindowHashSilently();resetWindowAndCanvasDims();drawCanvasBorders();generateFullArray();clearMainCanvas();drawAllRects()});$initialState.on("change",".init__checkbox",function(){getInitArrayFromCheckboxes();setWindowHashSilently();resetWindowAndCanvasDims();drawCanvasBorders();generateFullArray();clearMainCanvas();drawAllRects()});$(".numeric-input").on("keydown",function(e){var that=this;function changeHandler(){$(that).triggerHandler("change")}if(e.which>47&&e.which<58||e.which===8){w.setTimeout(changeHandler,0)}else if(e.which===9||e.which===37||e.which===38||e.which===39||e.which===40){return}else{return false}});$(".rule__label").on("mousedown",function(){$(this).siblings("input").trigger("click");return false});$initialState.on("mousedown",".init__label",function(){$(this).siblings("input").trigger("click");return false});$(".rule__label").on("click",function(){return false});$initialState.on("click",".init__label",function(){return false});w.addEventListener("resize",debounce(onResize,30));(function($){var div=doc.createElement("div");div.style.flexBasis="1px";var warning=$("<p class=no-support-warning>Warning: Your browser doesn't"+" support <a href='http://caniuse.com/#feat=flexbox'>CSS Flexbox</a>,"+" which is required for this page. Please use the latest version of "|"Firefox, Chrome, or Opera to use this site.</p>");if(!div.style.flexBasis){$("body").prepend(warning)}})(jQuery);$("[data-hide-instructions]").on("click",function(){$html.removeClass("show-instructions");$header.slideUp("slow")});$("[data-show-instructions]").on("click",function(){$html.addClass("show-instructions");$header.slideDown("slow")});$html.on("keydown.tablistener",function(e){if(e.which===9){$html.removeClass("tab-inactive");$html.off("keydown.tablistener")}});$("[data-show-menu], [data-hide-menu]").on("click",function(){$html.toggleClass("show-menu")});$(".more-options__button").on("click",function(){$("html, body").animate({scrollTop:0},1e3)});$("#show-init-borders").on("change",function(){$("#initial-state").toggleClass("show-borders")});$("#show-gen-borders").on("change",function(){canvasBorders.classList.toggle("c-inner-borders--hidden")});$("#limit-grid").on("change",function(){$gridGroup.toggleClass("limit-grid-width")});urlHashCheckbox.on("change",function(){if($(this).prop("checked")){opts.setUrlHash=true;setWindowHashSilently()}else{opts.setUrlHash=false;if("replaceState"in history&&w.location.protocol.indexOf("http")===0){history.replaceState("",doc.title,w.location.pathname+w.location.search)}else{w.location.hash=""}}});$(".stylish-checkbox__text").on("click",function(){$(this).siblings("input").click()})})(window,document,jQuery);
//# sourceMappingURL=c-a-min.js.map